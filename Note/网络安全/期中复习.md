---
title: Cisco期中复习
---

# Cisco期中复习

### 1.1.4 课后拓展练习

#### 一、选择题

1、Shodan 是一种专用搜索 Internet 上漏洞的搜索引擎，关于 Shodan 可以搜索的对象，下列说法正确的是：（**D**）  
A. 互联网上的摄像头  
B. 互联网上的无线路由器  
C. 互联网上的特定类型数据库服务器  
D. 以上皆是  

2、关于国家互联网应急中心（CNCERT/CC），以下哪个说法是正确的？（**C**）  
A. CNCERT/CC 成立于 2001 年 8 月，是一个盈利性的网络安全技术中心。  
B. CNCERT/CC 在全国设有 28 个分支机构，负责处理各类网络安全事件。  
C. CNCERT/CC 的主要职责是维护公共互联网安全，保障关键信息基础设施的安全运行。  
D. CNCERT/CC 不接受境外国家级应急组织的投诉。  

3、关于国家信息安全漏洞库（CNNVD），以下哪个说法是正确的？（**C**）  
A. CNNVD 成立于 2008 年，是中国信息安全测评中心负责建设的。  
B. CNNVD 只负责收集国内主流应用软件的安全漏洞。  
C. CNNVD 的主要职责是开展信息安全漏洞的采集收录、分析验证、预警通报和修复消控工作。  
D. CNNVD 仅服务于金融、交通和卫生医疗三个行业。  

#### 二、填空题

1、计算机网络中主要的安全威胁包括**故意威胁**和**偶然威胁**两类。根据实现方式的不同，网安全威胁可以分为物理威胁、**系统漏洞威胁**、**身份鉴别威胁**、有害程序威胁几类。  

2、网络安全类型主要包含**系统安全**、**网络安全**、**信息传播安全**、信息内容安全等方面。  

3、国家互联网应急中心全称为国家计算机网络应急技术处理协调中心，英文简称**CNCERT/CC**，业务范围包含事件发现、**预警通报**、应急处置及测试评估。  

4、中国国家信息安全漏洞库（CNNVD）编码规则与 CVE 兼容，编码规则为**CNNVD-年度-漏洞编号**。  

5、页面搜索包含两种方式：**关键字**和 Shodan 语句，Shodan 语法格式为**命令:参数**。  

### 1.2.5 课后拓展练习

#### 一、选择题

1、下列哪种攻击是针对网络接口层的攻击？（**B**）  
A. SQL 注入  
B. ARP 欺骗  
C. DDoS 攻击  
D. 社会工程学攻击  

2、在交换机中，MAC 地址表是如何建立的？（**C**）  
A. 交换机在启动时自动从网络上获取所有 MAC 地址  
B. 网络管理员手动输入每个 MAC 地址到交换机中  
C. 交换机在转发数据时通过检查数据帧中的源 MAC 地址字段来构建 MAC 地址表  
D. MAC 地址表是出厂时就已经预配置好的  

3、下列那个配置有可能导致下图中的 S3560 交换机的 Fa0/1 端口关闭。（**C**）  
A. C1(config)#interface fa0/1  
C1(config)#no shutdown  
B. C1(config)#interface fa0/1  
C1(config)# switchport port-security  
C1(config)# switchport port-security violation protect  
C. C1(config)#interface fa0/1  
C1(config)# switchport port-security  
D. C1(config)#interface fa0/1  
C1(config)# switchport port-security  
C1(config)# switchport port-security violation restrict  

4、网络包含一台三层交换机、一台二层交换机和 4 台主机，划分有 2 个 VLAN。三层交换机 Fa0/1 接口为 trunk 类型，接口下通过二层交换机连接 4 台主机，4 台主机之间能够正常通信，三层交换机 MAC 地址表中 Fa0/1 相关的条目至少有多少条。（**C**）  
A. 4  
B. 5  
C. 8  
D. 10  

#### 二、填空题

1、网络设备接入控制一般包含**本地**和远程两种形式，接入凭证一般采用账号、密码、指纹、虹膜、**人脸**等特征信息。  

2、交换机在转发数据时，会检查数据帧中的**目的MAC**地址信息，然后查找 MAC 地址表，从相应的端口转发数据。  

3、MAC 地址表中，每个表项由**Mac 地址**和**端口号**唯一标识。  

4、交换机启用端口安全后，违规处理方式有三种：**shutdown**、**protect**、restrict；默认为**shutdown**。  

5、在交换机端口接入安全配置中，可以通过**端口安全**来防范 MAC 地址攻击。  

### 1.3.6 课后拓展练习

#### 一、选择题

1、PPPoE 协议在 DSL 网络中的应用中，客户端通过哪种报文来发现接入服务器？（**A**）  
A. PADI  
B. PADO  
C. PADR  
D. PADS  

2、在 PPPoE 会话建立过程中，哪个阶段负责完成二层链路的建立和参数协商？（**A**）  
A. LCP 协商阶段  
B. 认证阶段  
C. IPCP 协商阶段  
D. 数据传输阶段  

3、PPPoE 协议中，哪种认证方式发送的认证信息是密文？（**B**）  
A. PAP  
B. CHAP  
C. MSCHAP  
D. EAP  

4、在 PPPoE 配置中，以下哪个命令用于创建拨号地址池？（**A**）  
A. ip local pool  
B. ip unnumbered  
C. interface virtual-template  
D. pppoe enable  

5、在基于 AAA 的 PPPoE 配置中，哪个命令用于设置默认的 PPP 认证组？（**A**）  
A. aaa authentication ppp default group radius  
B. aaa authorization network default group radius  
C. radius server  
D. ip route  

#### 二、填空题

1、PPPoE 协议的发现阶段包括两个主要任务：寻找可用的服务器和**建立 PPPoE 会话**。  

2、在 PPPoE 会话建立过程中，LCP 协商阶段使用的报文类型是**LCP**。  

3、在 PPPoE 配置中，虚拟接口的 IP 地址通常与物理接口地址处于**不同网段**。  

4、PPPoE 配置中，用于 PPPoE 接入的本地用户账号和密码的创建命令是**username 和 password**。  

#### 三、问答题

1、简述 bba-group 在 PPPoE 配置中的作用？**P41底部**  

2、简述 PPPoE 本地认证和远程认证的区别？**P40顶部**  

### 1.4.7 课后拓展练习

#### 一、选择题

1、DHCP Snooping 绑定表不会立即老化，以下哪项描述是正确的？（**C**）  
A. DHCP Snooping 绑定表分为动态绑定表和静态绑定表。  
B. DHCP Snooping 绑定表会自动老化。  
C. DHCP Snooping 绑定表需要手动清除。  
D. DHCP Snooping 绑定表在所有情况下都不需要老化。  

2、关于 DHCP Snooping 的描述，以下哪项是错误的？（**C**）  
A. DHCP Snooping 可以通过设置信任端口防止非法攻击。  
B. 在交换机的系统视图下执行 DHCP Snooping 命令，则该交换机可以同时处理 DHCPv4 和 DHCPv6 报文。  
C. 全局使能 DHCP Snooping 功能，不带任何后置参数的情况下设备默认只处理 DHCPV4 报文。  
D. 在 VLAN 视图下开启 DHCP Snooping 功能，对设备上相应 VLAN 下的 DHCP 报文生效。  

3、DHCP Snooping 在二层接入设备上如何获取信息并生成绑定表？（**B**）  
A. 从 DHCP DISCOVER 报文中获取信息。  
B. 从 DHCP ACK 报文中获取信息。  
C. 从 DHCP OFFER 报文中获取信息。  
D. 从 DHCP REQUEST 报文中获取信息。  

4、下列哪些不是 DHCP Snooping 的主要作用？（**C**）  
A. 防止 DHCP 仿冒者攻击。  
B. 防止中间人攻击和 IP/MAC Spoofing 攻击。  
C. 防止 DoS 攻击。  
D. 防止利用 option82 字段的仿冒 DHCP 续租报文攻击。  

#### 二、填空题

1、DHCP Snooping 是一种 DHCP 的安全特性，它主要用于解决设备应用 DHCP 时遇到的**DHCP 仿冒服务**攻击。  

2、DHCP Snooping 在交换机上默认将所有接口视为**非信任**接口。  

3、DHCP Snooping 可以配置**信任**端口和**非信任**端口，其中非信任端口不会处理**DHCP 应答消息**报文。  

4、DHCP Snooping 功能是通过在 DHCP Client 和 DHCP Server 之间建立一道**防火墙**来防止非法 DHCP 服务器的。  

### 1.5.8 课后拓展练习

#### 一、选择题

1、在无线局域网中，鉴别技术主要用于什么？（**B**）  
A. 加密数据  
B. 提供用户身份合法性的保证  
C. 控制数据传输速率  
D. 防止信号干扰  

2、无线局域网中，哪种加密技术提供了更高的安全性？（**C**）  
A. WEP  
B. WPA  
C. WPA2  
D. WPS  

3、无线局域网中，哪种攻击方式试图通过发送伪造的 DHCP 响应来欺骗客户端？（**C**）  
A. DHCP 耗尽攻击  
B. DHCP 劫持攻击  
C. 泛洪攻击  
D. 中间人攻击  

#### 二、填空题

1、无线局域网有两种组网模式，一种是**无固定基站的 Ad-Hoc（无线桥）模式**，另一种是**有固定基站的 Infrastructure（基础结构）模式**。  

2、无线路由器（wireless router）集成了无线 AP 和宽带路由器的功能，它不仅具备单纯性无线 AP 所有功能如支持无线接入功能、支持 DHCP 客户端、**VPN**、**防火墙**、**WEP 加密**等，而且还包括了网络地址转换 (NAT) 和局域网用户的网络连接共享功能。  

3、无线局域网常见的攻击方式有**网络窃听**、**RF 干扰攻击**、**暴力破解攻击**、**中间人攻击**等。  

#### 三、问答题

1、无线局域网有哪些安全问题？**P65**  

2、隐藏 SSID 以后，无线客户端怎样接入该无线网络？**P64 1.5.4**  

3、MAC 地址过滤的白名单和黑名单方式的区别是什么？**P67 顶部**  

### 2.1.5 课后拓展练习

#### 一、选择题

1、在 ACL 配置中，哪个命令用于创建一个标准访问控制列表？（**B**）  
A. access-list 1 deny 192.168.1.0 0.0.0.255  
B. ip access-list standard  
C. ip access-list extended  
D. access-list 100 permit any  

2、在 ACL 中，哪个原则建议只给受控对象完成任务所必须的最小权限？（**A**）  
A. 最小特权原则  
B. 最大权限原则  
C. 默认允许原则  
D. 默认拒绝原则  

3、在 Cisco 设备上，默认的 ACL 行为是什么？（**B**）  
A. 允许所有流量  
B. 拒绝所有流量  
C. 只允许特定流量  
D. 随机允许流量  

4、在 ACL 配置中，哪个命令用于将 ACL 应用到接口的入站流量？（**A**）  
A. interface fa0/0 ip access-group 1 in  
B. interface fa0/0 ip access-group 1 out  
C. interface fa0/0 ip access-group 1  
D. interface fa0/0 ip access-group 1 both  

5、在扩展 ACL 配置中，哪个命令用于拒绝特定主机的访问？（**A**）  
A. access-list 100 deny host 192.168.1.1  
B. access-list 100 deny 192.168.1.0 0.0.0.255  
C. access-list 100 deny any  
D. access-list 100 deny 192.168.1.1 0.0.0.0  

#### 二、填空题

1、ACL 的配置中，**permit** 操作用于允许数据包通过。  

2、在 Cisco 设备上，标准 ACL 默认的匹配方向是**顺序匹配**。  

3、ACL 的配置中，**show ip access-lists** 命令用于查看已配置的 ACL。  

4、在 ACL 配置中，**ip access-group** 命令用于在接口上指定数据流匹配方向。  

#### 三、问答题

1、思考在 2.1.4 任务实施结束后，PC2 能访问服务器的 WEB 服务吗？如果不能，思考故障原因，并修改配置使 PC2 能够访问服务器的 WEB 服务。  

2、假设你实现了一个访问列表可以阻止外部发起的 TCP 会话进入到你的网络中，但是你又想让内部发起的 TCP 会话的响应通过，那应该怎么办？思考并在 2.1.4 任务的网络拓扑结构上进行验证。  

### 2.2.4 课后拓展练习

#### 一、选择题

1、NAT（网络地址转换）的主要目的是什么？（**B**）  
A. 提高网络安全性  
B. 允许多个设备共享一个 IP 地址  
C. 提供远程访问服务  
D. 管理网络流量  

2、在 NAT 术语中，"内部本地地址"指的是什么？（**A**）  
A. 分配给内部计算机的 IP 地址  
B. 远程计算机的外部全局地址  
C. 连接内部网络的端口地址  
D. 连接外部网络的端口地址  

3、在配置动态 NAT 时，需要定义的地址池应该设置在哪个接口上？（**B**）  
A. 连接内部网络的接口  
B. 连接外部网络的接口  
C. 任意接口  
D. 不需要设置  

4、PAT（端口地址转换）允许多少个内部 IP 地址通过单个外部 IP 地址进行通信？（**B**）  
A. 一个  
B. 多个  
C. 取决于内部 IP 地址的数量  
D. 取决于外部 IP 地址的数量  

5、在 NAT 配置中，哪个命令用于查看 NAT 转换表项？（**A**）  
A. show ip nat translations  
B. show ip access-list  
C. show ip interface  
D. show running-config  

#### 二、填空题

1、PAT（复动态 NAT）的配置命令中，overload 关键字用于**允许多个内部 IP 共享一个外部 IP 地址**。  

2、地址转换可以在一定程度上阻止外部网络上的主机的恶意活动，因为它**隐藏了内部网络的真实 IP**。  

3、在使用地址转换时，路由器或防火墙会修改数据包的**源 IP 地址/源端口号**。  

4、如果企业内部需要连接入 Internet 的用户一共有 400 个，但该企业只申请到一个 C 类的公网 IP 地址，则可使用**PAT/复动态 NAT**方式实现公网地址复用。  

5、地址转换类型包括：**静态 NAT**、**动态 NAT**、**复动态 NAT（PAT）**。  

### 2.3.5 课后拓展练习

#### 一、选择题

1、GRE VPN 在 IP 协议中使用的协议号是多少？（**A**）  
A. 47  
B. 50  
C. 53  
D. 69  

2、在 GRE VPN 配置中，哪个命令用于创建虚拟隧道接口？（**A**）  
A. interface tunnel tunnel_number  
B. interface tunnel  
C. interface tunnel ip  
D. interface tunnel mode gre  

3、在 GRE VPN 配置中，哪个命令用于定义隧道接口的 IP 地址？（**A**）  
A. ip address ip_addr mask  
B. ip tunnel address ip_addr mask  
C. tunnel ip address ip_addr mask  
D. tunnel interface ip_addr mask  

4、GRE VPN 的一个主要优点是？（**A**）  
A. 支持多播  
B. 加密数据  
C. 适用于所有网络环境  
D. 易于配置和管理  

#### 二、填空题

1、在 GRE VPN 配置中，tunnel source 命令用于定义隧道接口的**源**地址。  

2、GRE VPN 的封装过程在原始包头的前面增加了一个**GRE**包头和一个新 IP 包头。  

3、GRE VPN，即通用路由封装协议，是一种的第**3**层 VPN 隧道协议。  

4、GRE VPN 的一个主要缺点是**不提供加密**，这意味着它可能不适合网络安全要求高的用户。  

5、在配置 GRE VPN 时，必须指定 Tunnel 接口的**源**地址和**目的**地址，这两个地址唯一标识了一个隧道。  

### 2.4.7 课后拓展练习

#### 一、选择题

1、IKE（Internet Key Exchange）协议在 IPSec VPN 中的作用是什么？（**B**）  
A. 提供数据加密  
B. 管理安全联盟（SA）  
C. 进行身份验证  
D. 路由数据包  

2、在 IPSec VPN 配置中，哪个命令用于启用 IKE？（**A**）  
A. crypto isakmp enable  
B. crypto isakmp policy  
C. crypto isakmp key  
D. crypto isakmp authentication  

3、在 IPSec VPN 的 IKE 协商过程中，哪个阶段负责协商会话参数和安全策略？（**A**）  
A. 第一阶段  
B. 第二阶段  
C. 第三阶段  
D. 第四阶段  

4、在 IPSec VPN 配置中，哪个命令用于设置预共享密钥？（**A**）  
A. crypto isakmp key  
B. crypto isakmp authentication  
C. crypto isakmp policy  
D. crypto isakmp lifetime  

#### 二、填空题

1、IPSec VPN 支持的 VPN 类型包括**站点到站点 VPN**和**远程接入 VPN**。  

2、IPSec VPN 的两种模式是**传输模式**和**隧道模式**。  

3、在 IPSec VPN 配置中，crypto isakmp policy 命令用于**建立 IKE 策略**。  

4、在 IPSec VPN 配置中，crypto map 命令用于**创建加密图并应用到接口**。  

#### 三、问答题

1、思考在上述任务中 IPSec VPN 与 NAT 业务并存后数据是如何封装及传输的。  

2、使用 show crypto isakmp policy，show crypto ipsec transform-set，show crypto isakmp sa 查看 VPN 建立情况，思考显示信息的含义。  

3、对于静态 NAT，数据包就不是通过 ACL 来匹配，而是通过 NAT 里面的配置的地址来匹配，此时该如何解决 IPSec 与 NAT 的冲突问题？  

### 2.5.6 课后拓展练习

#### 一、选择题

1、Remote Access VPN 主要实现什么功能？（**A**）  
A. 允许远程用户安全访问公司内部网络资源  
B. 实现公司内部网络之间的安全通信  
C. 加密所有进出公司的网络流量  
D. 提供匿名上网服务  

2、关于 IPSec VPN 中的 ESP 协议，以下说法正确的是？（**B**）  
A. ESP 协议仅仅支持数据加密  
B. ESP 协议支持数据完整性和加密  
C. ESP 协议仅仅支持数据完整性校验  
D. ESP 协议不支持任何安全功能  

3、Remote Access IPSec VPN 通常使用哪种认证方式？（**A**）  
A. 用户名和密码  
B. 密钥交换  
C. 公钥/私钥加密  
D. 指纹识别  

#### 二、填空题

1、在配置 IPSec VPN 时，通常需要为公共网络接口配置**公有**IP 地址。  

2、ESP（封装安全载荷）协议在 IPSec VPN 中提供了数据的**加密**和完整性校验功能。  

3、Remote Access IPSec VPN 通常用于实现远程用户通过公共网络（如互联网）**远程安全接入**公司内部网络资源。  

4、在 IPSec VPN 中，**隧道-Tunnel**模式用于保护整个 IP 数据包，从而隐藏了内网主机的 IP 地址。  

5、RRI（反向路由）是 VPN 网关根据**接入用户IP地址**动态建立的回程路由。  

### 2.6.5 课后拓展练习

#### 一、选择题

1、在配置 GRE Over IPSec VPN 时，预共享密钥通常用于什么目的？（**C**）  
A. 数据加密  
B. 数据完整性检查  
C. 认证  
D. 数据封装  

2、在 Gre Over IPSec VPN 中，哪个命令用于定义逻辑接口？（**A**）  
A. interface Tunnel1  
B. interface FastEthernet0/0  
C. interface FastEthernet1/0  
D. interface Serial0/0/0  

3、在 GRE Over IPSec VPN 中，通常使用哪种协议来测试隧道连通性？（**A**）  
A. ICMP  
B. TCP  
C. UDP  
D. GRE  

4、在 GRE Over IPSec VPN 中，IPSec 的主要功能是什么？（**B**）  
A. 数据封装  
B. 数据加密和认证  
C. 数据转发  
D. 数据路由  

5、配置 GRE Over IPSec VPN 时，首先需要做的是哪一步？（**B**）  
A. 配置 IPsec 策略  
B. 配置 GRE 隧道  
C. 配置路由协议  
D. 配置 NAT  

#### 二、填空题

1、在 GRE Over IPSec VPN 中，如果需要在 Tunnel 接口上配置路由，则需要在设备上添加一条指向**对端**子网的路由。  

2、在 GRE Over IPSec VPN 中，Tunnel 接口的源地址和目的地址是通过**tunnel source**和**tunnel destination**命令进行配置的。  

3、在 GRE Over IPSec VPN 中，IPSec 主要负责提供数据的**加密**和**认证**，确保数据在传输过程中的机密性和完整性。  

4、为了将 IPsec 加密应用于特定接口，需要通过**crypto map**命令创建 IPsec 加密并将其应用于该接口。  

5、IPsec VPN 使用 IKE(ISAKMP)策略进行密钥协商，策略中可以配置**加密算法**、校验算法（如 MD5）和密钥算法（如 AES）。  

### 2.7.5 课后拓展练习

#### 一、选择题

1、在 QoS 配置中，哪个命令用于应用策略映射到接口？（**B**）  
A. interface  
B. service-policy  
C. ip access-group  
D. ip nat inside  

2、在 QoS 配置中，WFQ 代表什么？（**A**）  
A. 加权公平队列  
B. 加权随机队列  
C. 加权循环队列  
D. 加权最短队列  

3、在 QoS 中，当网络发生拥塞时，哪种技术可以丢弃某些数据包或降低低数据包的发送速率，以减轻网络的负担？（**B**）  
A. 数据包分类  
B. 拥塞避免  
C. 拥塞管理  
D. 资源预留  

4、在 QoS 中，哪个服务模型不提供任何服务质量保证？（**A**）  
A. 尽力而为（Best-Effort）模型  
B. 预留（Reserved）模型  
C. 区分（Differentiated）模型  
D. 综合（Integrated）模型  

5、在 QoS 中，哪种技术可以用于在网络拥塞的情况下，确保具有较高优先级的数据包可以更早地通过网关？（**C**）  
A. 流量整形  
B. 流量监管  
C. 优先级队列和调度  
D. 资源预留  

6、在 QoS 中，数据包分类和标记的主要目的是什么？（**A**）  
A. 确定数据包的优先级  
B. 确定数据包的大小  
C. 确定数据包的传输路径  
D. 确定数据包的源地址和目标地址  

#### 二、填空题

1、QoS 配置中，**服务质量QoS**是为网络提供更高优先级服务的一种能力，包括专用带宽、抖动控制和延迟减少等。  

2、QoS 配置中，**set**命令用于设置分类数据包的 QoS 标签。  

3、流分类规则可以使用 IP 报文头的**ToS**字段的优先级位或**DSCP 值**，识别出有不同优先级特征的流量。  

4、常用的队列调度机制有**先进先出队列（FIFO）**、**优先级队列（PQ）**、定制队列 CQ、加权公平队列 WFQ 。  

#### 三、问答题

1、解释 QoS 中的三种服务模型，并说明它们的主要区别。  
尽力而为服务模型（Best Effort Service Model）提供最基本的服务，不保证服务质量；  
综合服务模型（Integrated Services Model）允许网络为特定流量提供保证的服务质量；  
2、在 QoS 配置中，分类和策略映射的作用是什么？  

# R0 PAT配置

enable
conf t
access-list 1 permit 192.168.1.0 0.0.0.255 // 定义一个名为1的ACL 目的是让R0左侧的 192.168.1.0/24 网络中的设备能够访问外部公共网络
interface FastEthernet0/0 // 定义NAT的边界。ip nat inside命令将Fa0/0接口标记为连接内部网络的接口，ip nat outside命令将Se0/3/0接口标记为连接外部网络的接口
ip nat inside
interface Serial0/3/0
ip nat outside
ip nat inside source list 1 interface Serial0/3/0 overload 
// 告诉路由器：将匹配ACL 1的源IP地址即内部网络 192.168.1.0/24, 转换成Se0/3/0接口的IP地址，并启用overload(即PAT), 允许多个内部IP共享这一个公网IP

# R1 PAT配置

access-list 1 permit 192.168.2.0 0.0.0.255
interface Fa0/0
ip nat inside
interface Se0/3/0
ip nat outside
ip nat inside source list 1 interface Se0/3/0 overload

# R0 配置IPSec VPN

crypto isakmp policy 1
hash md5
encryption des
authentication pre-share
crypto isakmp key wxit address 210.28.144.2
// wxit: 预共享密钥(Pre-shared Key), 必须与对端R1上配置的密钥完全一致, 作为双方身份验证的密码
// address 210.28.144.2: 指定这个密钥是用于和公网IP为 210.28.144.2 的对等体(Peer)进行通信的, 也就是R1
crypto ipsec transform-set wxitvpn esp-des esp-md5-hmac
access-list 110 permit gre 58.1.1.0 0.0.0.3 210.28.144.0 0.0.0.3
// 一个极其关键的ACL, 定义了需要被IPSec加密的流量
// permit gre: 表示只对GRE协议的流量感兴趣
// 58.1.1.0 0.0.0.3: 匹配源地址 58.1.1.0是R0公网IP所在网段 0.0.0.3是/30的反向掩码 这匹配了从R0发出的GRE包
// 210.28.144.0 0.0.0.3: 匹配目标地址 210.28.144.0是R1公网IP所在网段 这匹配了发往R1的GRE包
crypto map wxitmap 1 ipsec-isakmp
set peer 210.28.144.2 
set transform-set wxitvpn
match address 110
interface Se0/3/0
crypto map wxitmap

# R1 配置IPSec VPN

crypto isakmp policy 1
hash md5
encryption des
authentication pre-share
crypto isakmp key wxit address 58.1.1.1
crypto ipsec transform-set wxitvpn esp-des esp-md5-hmac
access-list 110 permit gre 210.28.144.0 0.0.0.3 58.1.1.0 0.0.0.3
crypto map wxitmap 1 ipsec-isakmp
set peer 58.1.1.1
set transform-set wxitvpn
match address 110
interface Se0/3/0
crypto map wxitmap

# R0 配置GRE VPN

interface Tunnel1
tunnel source Se0/3/0 // 指定GRE数据包的源IP将使用Se0/3/0接口的IP，即R0的公网IP 58.1.1.1
ip address 58.1.2.1 255.255.255.252 // 为虚拟隧道接口本身分配一个IP地址, 58.1.2.0/30 是专门为这个隧道链路规划的一个独立网段, R0这端是.1, R1那端就是.2, 它们通过此地址通信
tunnel destination 210.28.144.2 // 指定GRE数据包的目的IP，即R1的公网IP 210.28.144.2
ip route 0.0.0.0 0.0.0.0 Se0/3/0
ip route 192.168.2.0 255.255.255.0 58.1.2.2 // 这是一个静态路由, 它告诉R0路由器, 要访问对面的局域网192.168.2.0/24, 应该把数据包发给58.1.2.2

# R1 配置GRE VPN

interface Tunnel1
tunnel source Se0/3/0
ip address 58.1.2.2 255.255.255.252
tunnel destination 58.1.1.1
ip route 0.0.0.0 0.0.0.0 Se0/3/0
ip route 192.168.1.0 255.255.255.0 58.1.2.1

实验结果

1. pc0(192.168.1.1) ping pc1(192.168.1.2), 通, 但是在R0 show ip nat translations无nat转换记录(命令无输出)

2. pc0 ping 外网(210.28.144.2), 通, 在R0 show ip nat translations有nat转换记录
   
   ```shell
   Pro  Inside global     Inside local       Outside local      Outside global
   icmp 58.1.1.1:13       192.168.1.1:13     210.28.144.2:13    210.28.144.2:13
   icmp 58.1.1.1:14       192.168.1.1:14     210.28.144.2:14    210.28.144.2:14
   icmp 58.1.1.1:15       192.168.1.1:15     210.28.144.2:15    210.28.144.2:15
   icmp 58.1.1.1:16       192.168.1.1:16     210.28.144.2:16    210.28.144.2:16
   ```

3. 在R0, R1上使用show crypto isakmp sa查看VPN建立情况
   
   ```shell
   IPv4 Crypto ISAKMP SA
   dst             src             state          conn-id slot status
   210.28.144.2    58.1.1.1        QM_IDLE           1004    0 ACTIVE
   IPv6 Crypto ISAKMP SA
   ```

~~4. 仿真模式, 用pc0 ping pc3, 单步运行~~

实验总结
私有IP地址192.168.1.x和192.168.2.x，公网上无法被路由, PAT作用: 当内部电脑需要访问公共网络时，路由器会将源IP（私有IP）转换成自己的公网IP地址。这样，外部网络看来，所有请求都来自于路由器。这是为了让内网电脑能访问公网资源。

GRE隧道：一条虚拟的点对点网线。作用是把一个完整的IP包（比如从 192.168.1.1 发往 192.168.2.1 的包）装进另一个IP包里。新的外层IP包的源和目的地址是两个路由器的公网IP（58.1.1.1 和 210.28.144.2）。这样，私有地址的数据包就能在公共网络上传输了。但GRE本身不提供加密。

IPSec：这是一种提供网络层安全性的协议套件。它通过加密和验证来保护IP通信。在实验中，IPSec的作用并不是直接加密PC之间的数据包，而是加密GRE隧道本身的数据包。这就叫“GRE over IPSec”，既利用了GRE能够封装多种协议的灵活性，又利用了IPSec的强大安全性。