# 概要

中断会暂停当前的执行流去执行中断函数对应的函数

# 中断控制器

在中断控制器中发生了什么?

信号首先来到**边沿检测电路**, 在此之前
我们需要配置**下降沿触发选择寄存器**和**上升沿出发选择寄存器**来决定需要捕获的边沿类型;

如捕获到了边沿, 会发送1到**请求挂起寄存器**;
 (其实中间还有个或门, 或门的另一个输出是**软件中断事件寄存器**, 相当于
软件事件中断和外部中断共用请求挂起寄存器)

请求挂起寄存器再输出1到一个与门, 与门的另一个输入是**中断屏蔽寄存器**;
 (我们配置某个 GPIO 为 GPIO_EXTIxx 时, 就相当于配置该寄存器为1, 也就是说
这是控制 GPIO 是否开启中断功能的寄存器)

>在此之前提到的所有寄存器是所有中断线共享的, 像是 EXTI12 的信号会存在第12位;

信号最终来到 **NVIC(嵌套向量中断控制器)**, 掌控**中断向量表**
中断向量表管理中断和中断处理函数的对应;
 (不一定一对一, 也会有多个中断共享一个中断处理函数)

中断是一直检测中断线的, 还记得上面设置了请求挂起寄存器, 也就是说
我们执行完中断处理函数后, 会一直触发中断, 于是我们需要在函数末尾复位该寄存器;
 (HAL自动生成对应的函数, 无需手动)

---

以上是一个中断的情况, 如果多个中断同时启用, 并且恰好同时触发呢?

中断向量表中同时记录中断优先级, 包括**抢占优先级**和**响应优先级**;
 二者共享4位寄存器, 可以全都配置抢占优先级, 也可用于配置二者, 一般来说, 抢占优先级用到较多, 4位全配即可

当两个中断几乎同时发生, 会先比较抢占优先级, 高的先执行, 若抢占优先级相同, 会比较响应优先级;
 若都相同, 会按照中断向量表的排序执行

当一个中断执行的过程中触发另一个中断, 会比较抢占优先级, 抢占优先级高的话, 会中断当前的中断, 去执行新的中断
